[//]: # (变量管理)

[//]: # (=====)

## 一、关于变量

在AngusTester中，变量管理是一个核心功能，旨在提高测试过程的灵活性和可维护性。通过定义变量，用户可以创建可重复使用的值，并在测试用例中使用变量占位符`{变量名}`来引用这些值。变量不仅可以简化测试逻辑，还能增强测试用例的可扩展性和可重复性。在执行测试采样前，变量占位符会被替换为对应的变量值，而在执行过程中，这些值不会发生变化。

***注意事项:***

- 确保在使用变量前，已正确配置并定义了变量。
- 非常量值变量，会在执行前初始化值，在执行采样中变量值不会改变，确保测试的一致性。

## 二、变量信息

在AngusTester中，每个变量包含以下字段信息：

- ID：每个变量的唯一标识符，创建变量后自动分配。
- 项目ID：变量所属项目唯一标识符。
- 名称：变量的名称，供用户识别和引用。命名规则：支持数字、字母和!$%^&*_-+=./，最长100个字符。
- 描述：对变量的详细描述，帮助其他用户理解变量的用途。
- 值：变量当前的值，可以是静态值或动态提取的值。
- 是否密码值：指示该变量是否为敏感信息（如密码、秘钥等），以便在展示时进行特殊处理。
- 提取规则：定义变量值提取的具体规则，指明是文件提取、Http提取还是Jdbc提取。具体提取配置参数请查看：“参数化”->“变量”->“[变量提取配置](https://www.xcan.cloud/help/doc/205509853639082016?c=248564029595844674)”。
- 创建人：创建该变量的用户。
- 创建时间：创建变量的时间。
- 最后修改人：最后修改该变量的用户。
- 最后修改时间：最后一次修改变量的时间。

## 三、变量操作

AngusTester提供多种操作来管理变量，具体操作及其说明如下：

### 1、添加静态变量

添加一个静态变量，静态变量的值在整个执行采样过程中保持不变，适合存储固定的常量信息，便于在多个场景中复用。

操作步骤:

1. 登录AngusTester，进入“数据”->“变量”管理界面。
2. 点击“添加静态变量”按钮。
   ![](https://bj-c1-prod-files.xcan.cloud/storage/pubapi/v1/file/variable-static-add.png?fid=251751339858592084&fpt=AvDNe0JiyADks5cyObqlB023veLOt5d2SDZiJ7FX)
3. 填写变量名称、描述及值，是否为密码值信息。
   ![](https://bj-c1-prod-files.xcan.cloud/storage/pubapi/v1/file/variable-static-add-view.png?fid=251751339858592082&fpt=yduS7Yp3Bd66sPfZVOTAroS59zFNKnBDFXrQLOix)
4. 如果值包含Mock函数，可以在“预览”Tab页面中查看和调试变量值。
   ![](https://bj-c1-prod-files.xcan.cloud/storage/pubapi/v1/file/variable-static-preview.png?fid=251751339858592086&fpt=jZfMZjUW2sUgj0Kxtq2dj4mKQWvcxmu5jmqjGtnj)
5. 点击“保存”完成操作。

***注意事项：***

- 可以定义一个常量、Mock数据函数或包含Mock数据函数的文本作为变量值。
- 如果变量值中包含Mock数据函数，默认每一次迭代前更新一次值，同一个迭代内采样请求变量值保持不变。

### 2、添加文件提取变量

从指定文件中提取数据并创建变量。适用于需要从外部文件读取配置信息或数据的场景，便于数据的动态管理。

操作步骤:

1. 登录AngusTester，进入“数据”->“变量”管理界面。
2. 点击添加静态变量下拉操作中“文件提取变量”按钮。
3. 填写变量信息、提取文件路径、文件格式、开始读取位置，以及对读取数据是否再次提取处理。
   ![](https://bj-c1-prod-files.xcan.cloud/storage/pubapi/v1/file/variable-file-add.png?fid=251751339858592074&fpt=l3LQKOFShZW1DVhC43b84IyUfsd6DJweVh8i68Y3)
4. 配置完后可以在“预览”Tab页面中查看提取值。
   ![](https://bj-c1-prod-files.xcan.cloud/storage/pubapi/v1/file/variable-file-preview.png?fid=251751339858592076&fpt=irFPXMyIdMbcb9I26rVeTZnbFcmTVe38giY0PZ0B)
5. 点击“保存”完成操作。

***注意事项：***

- 确认提取文件开始行和列索引是否正确，默认从0开始。

### 3、添加Http提取变量

通过HTTP请求提取数据并创建变量。适合需要从外部API或服务获取动态数据的场景，常用于获取一个用户访问令牌，避免每次手动更新。

操作步骤:

1. 登录AngusTester，进入“数据”->“变量”管理界面。
2. 点击添加静态变量下拉操作中“Http提取变量”按钮。
3. 填写变量信息、提取请求URL、请求方式及其他参数，定义从响应中提取变量值规则。
   ![](https://bj-c1-prod-files.xcan.cloud/storage/pubapi/v1/file/variable-http-add.png?fid=251751339858592078&fpt=J5Q17uPJ6bittD4x1pzWmqiBUEdfEZDljG6Vt3BK)
4. 配置完后可以在“预览”Tab页面中查看提取值。
   ![](https://bj-c1-prod-files.xcan.cloud/storage/pubapi/v1/file/variable-http-preview.png?fid=251751339858592088&fpt=Y7xicCZfs4Qqt3QkF2luZUxBh1lRQ8SsmrJ7gwub)
5. 点击“保存”完成操作。

### 4、添加Jdbc提取变量

通过JDBC连接数据库提取数据并创建变量。适合需要从数据库中获取数据进行分析或处理的场景，能够实现数据库动态交互。

操作步骤:

1. 登录AngusTester，进入“数据”->“变量”管理界面。
2. 点击添加静态变量下拉操作中“Jdbc提取变量”按钮。
3. 填写变量信息、数据源信息、查询(Select)语句，以及从查询结果中读取位置。
   ![](https://bj-c1-prod-files.xcan.cloud/storage/pubapi/v1/file/variable-jdbc-add.png?fid=251751339858592080&fpt=7eF1QaNVzYEhGAHZpsgtVToO2kdIgVD8onKBSOyq)
4. 配置完后可以在“预览”Tab页面中查看提取值。
5. 点击“保存”完成操作。

### 5、编辑变量

允许用户修改已存在变量的名称、值或提取规则等。适用于变量信息需要更新或调整的情况下，确保变量的有效性与准确性。

操作步骤:

1. 登录AngusTester，进入“数据”->“变量”管理界面。
2. 在变量列表中找到要编辑的变量。
3. 点击“编辑”按钮，然后修改所需字段。
4. 点击“保存”完成操作。

### 6、删除变量

删除单个变量。当某个变量不再需要或者需要进行清理时，可以使用此功能进行删除。

操作步骤:

1. 登录AngusTester，进入“数据”->“变量”管理界面。
2. 在变量列表中找到要删除的变量，并点击“删除”按钮。
3. 系统将弹出确认对话框，提示您确认是否删除该变量。
4. 确认删除操作，系统将提示确认以防误操作。

***注意事项:***

- 删除变量将永久移除该执行记录，确认无误后再进行此操作。

### 7、批量删除变量

通过此操作，可以一次性删除多个变量。适合需要快速清理大量无用变量的场景，节省时间与操作步骤。

操作步骤:

1. 登录AngusTester，进入“数据”->“变量”管理界面。
2. 点击变量列表右上方“批量删除”按钮。
3. 勾选需要删除的变量，再点击确定，系统将弹出确认对话框，提示您确认是否删除该变量。
4. 确认删除操作，系统将提示确认以防误操作。

***注意事项:***

- 删除变量将永久移除该执行记录，确认无误后再进行此操作。

### 8、导出变量

允许用户将选定的变量导出为YAML文件格式，便于在其他项目或系统中使用和共享。

操作步骤:

1. 登录AngusTester，进入“数据”->“变量”管理界面。
2. 在变量列表中找到要导出的变量，并点击“导出”按钮。
3. 系统将生成一个文件，保存到本地。

### 9、导出所有变量

将系统中所有变量导出为YAML文件格式，方便进行备份或迁移，确保数据的完整性与安全性。

1. 登录AngusTester，进入“数据”->“变量”管理界面。
2. 点击变量列表右上方“导出”按钮。
3. 系统将生成一个文件，保存到本地。

### 10、导入变量

用于将之前导出的变量文件导入到系统中，方便快速恢复或集成已有的变量配置，提升工作效率。

操作步骤:

1. 登录AngusTester，进入“数据”->“变量”管理界面。
2. 点击变量列表右上方“导入”按钮。
3. 在弹窗里选择需要导入变量文件。
4. 点击“确定”完成导入。

### 11、克隆变量

创建现有变量的副本，适合需要在不同场景中使用相似变量的情况下，避免重复创建和配置。

操作步骤:

1. 登录AngusTester，进入“数据”->“变量”管理界面。
2. 在变量列表中找到要克隆的变量，并点击“克隆”按钮。
3. 系统将自动复制出一个新的变量，再根据需要快速修改变量信息。

### 12、接口中参数化变量

允许用户在接口中引用参数化变量，使得接口的调用可以接受动态输入，增强接口的灵活性和复用性。

操作步骤:

1. 登录AngusTester，进入“接口”->“服务”管理界面。
2. 点击打开需要参数化变量的接口，在接口调试页面“参数化”Tab中引入对应变量，引入后及完成变量参数化。
   ![](https://bj-c1-prod-files.xcan.cloud/storage/pubapi/v1/file/variable-ref-api-assoc.png?fid=251751417168003302&fpt=Zup6ZWzaq2hyVn4du94cLG6zP0M09lbtI5S73Gn1)
3. 在接口参数值中通过`{变量名}`使用数据集参数变量。
   ![](https://bj-c1-prod-files.xcan.cloud/storage/pubapi/v1/file/variable-ref-apis.png?fid=251751417168003304&fpt=wobbQoL4GGbn5QxbS1WnsroEjWSlNUhEYXyZDLMb)

***注意事项：***

- 接口只有引入已定义变量才会生效，不建立引用关系直接使用变量占位符不会生效。

### 13、场景中参数化变量

允许用户在场景中引用参数化变量，使得接口的调用可以接受动态输入，增强接口的灵活性和复用性。

操作步骤:

1. 登录AngusTester，进入“场景”管理界面。
2. 点击打开需要参数化变量的场景，在场景执行配置中“变量”配置选项中引入对应变量，引入后及完成变量参数化。
3. 在场景接口参数值中通过`{变量名}`使用数据集参数变量。

***注意事项：***

- 场景只有引入已定义变量才会生效，不建立引用关系直接使用变量占位符不会生效。
